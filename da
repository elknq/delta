--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘       WALLHAN HUB - FINAL V11            â•‘
    â•‘  âœ… FIX: Wood Shield Persistence & Fling â•‘
    â•‘  âœ… FIX: Dance Function (Stop & Play)    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙŠÙ†Øª
local SavedCheckpoint = nil
local _G_States = { WoodShield = false, Noclip = false, ESP = false }

-- [[ Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±Ù‚ØµØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ]]
local function StopCurrentEmotes()
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
    if humanoid then
        for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
            track:Stop()
        end
    end
end

-- [[ Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ§Øª - Beautiful Dance (FE) ]]
local function PlayFEEmote(animationId)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        
        StopCurrentEmotes() 
        task.wait(0.1) -- âœ… FIX: Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„ØªØ§Ù…
        
        local humanoid = LocalPlayer.Character.Humanoid
        local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)
        
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. animationId
        
        local load = animator:LoadAnimation(anim)
        load.Priority = Enum.AnimationPriority.Action
        load:Play()
        
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "âœ¨ Wallhan Emotes",
            Text = "ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ© (FE)!",
            Duration = 3
        })
    end
end

-- [[ Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø·Ø§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙŠÙ„ÙŠØ¨ÙˆØ±Øª ]]
local function GiveTeleportTool()
    local tp = Instance.new("Tool")
    tp.Name = "Wallhan TP ğŸ“"
    tp.RequiresHandle = false
    
    tp.Activated:Connect(function() 
        local currentMouse = LocalPlayer:GetMouse()
        if currentMouse.Hit then
            LocalPlayer.Character:MoveTo(currentMouse.Hit.p) 
        end
    end)
    
    tp.Parent = LocalPlayer.Backpack
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Wallhan Hub",
        Text = "Teleport Tool Added! ğŸ“",
        Duration = 3
    })
end

-- [[ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (Minimal UI) ]]
local function CreateMinimalUI()
    
    local parentGui = LocalPlayer.PlayerGui or game.CoreGui
    
    local sg = Instance.new("ScreenGui")
    sg.Name = "WallhanHub_Minimal"
    sg.ResetOnSpawn = false
    sg.Parent = parentGui
    
    -- Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
    local Main = Instance.new("Frame", sg)
    Main.Size = UDim2.new(0, 200, 0, 350)
    Main.Position = UDim2.new(1, -210, 0.5, -175)
    Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Main.Active = true
    Main.Draggable = true
    Main.BorderSizePixel = 0
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
    
    local Title = Instance.new("TextLabel", Main)
    Title.Size = UDim2.new(1, 0, 0, 30)
    Title.Text = "Wallhan Hub V11"
    Title.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.Font = Enum.Font.SourceSansBold
    Title.TextSize = 16
    
    local List = Instance.new("ScrollingFrame", Main)
    List.Size = UDim2.new(1, 0, 1, -30)
    List.Position = UDim2.new(0, 0, 0, 30)
    List.BackgroundTransparency = 1
    List.ScrollBarThickness = 4
    
    local listLayout = Instance.new("UIListLayout", List)
    listLayout.Padding = UDim.new(0, 5)
    listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    -- Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Toggle Ø¨Ø³ÙŠØ·
    local function CreateToggle(txt, stateKey)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(0.9, 0, 0, 35)
        b.Font = Enum.Font.SourceSans
        b.TextSize = 14
        b.TextColor3 = Color3.new(1, 1, 1)
        Instance.new("UICorner", b).CornerRadius = UDim.new(0, 5)
        
        local function Upd()
            b.Text = txt .. (_G_States[stateKey] and " [ON]" or " [OFF]")
            b.BackgroundColor3 = _G_States[stateKey] and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(50, 50, 50)
        end
        b.MouseButton1Click:Connect(function() 
            _G_States[stateKey] = not _G_States[stateKey] 
            Upd() 
        end)
        Upd()
    end
    
    -- Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø¹Ø§Ø¯ÙŠ Ø¨Ø³ÙŠØ·
    local function CreateButton(txt, cb)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(0.9, 0, 0, 35)
        b.Text = txt
        b.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        b.TextColor3 = Color3.new(1, 1, 1)
        b.Font = Enum.Font.SourceSans
        b.TextSize = 14
        Instance.new("UICorner", b).CornerRadius = UDim.new(0, 5)
        b.MouseButton1Click:Connect(cb)
    end
    
    -- [ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ]
    CreateToggle("WOOD SHIELD", "WoodShield")
    CreateToggle("NOCLIP", "Noclip")
    CreateToggle("ESP", "ESP")
    
    CreateButton("PLAY DANCE (FE)", function()
        PlayFEEmote("104077918384157")
    end)
    
    CreateButton("GIVE TELEPORT TOOL ğŸ“", GiveTeleportTool)
    
    CreateButton("SET CHECKPOINT", function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            SavedCheckpoint = LocalPlayer.Character.HumanoidRootPart.CFrame
            game:GetService("StarterGui"):SetCore("SendNotification", {Title = "Wallhan Hub", Text = "Checkpoint Saved! âœ…", Duration = 3})
        end
    end)
    
    CreateButton("TP TO CHECKPOINT", function()
        if SavedCheckpoint and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = SavedCheckpoint
        else
            game:GetService("StarterGui"):SetCore("SendNotification", {Title = "Wallhan Hub", Text = "No Checkpoint Set! âŒ", Duration = 3})
        end
    end)
    
    -- Ø²Ø± Toggle Ù„ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    local ToggleBtn = Instance.new("TextButton", sg)
    ToggleBtn.Size = UDim2.new(0, 40, 0, 40)
    ToggleBtn.Position = UDim2.new(1, -50, 0, 10)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
    ToggleBtn.Text = "W"
    ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
    ToggleBtn.Font = Enum.Font.SourceSansBold
    ToggleBtn.TextSize = 20
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    ToggleBtn.Draggable = true
    ToggleBtn.MouseButton1Click:Connect(function() 
        Main.Visible = not Main.Visible 
    end)
    
    -- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    Main.Visible = false
end

-- [[ Wood Shield - Ù…Ø­Ø³Ù‘Ù† (ÙŠØ¨Ù‚Ù‰ Ù„Ø£Ø·ÙˆÙ„ Ù…Ø¯Ø©ØŒ Ø¯ÙˆØ±Ø§Ù† Ø£Ø³Ø±Ø¹ ÙˆØ£Ù‚Ø±Ø¨ØŒ ÙŠÙ‚Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù‚ÙˆØ©) ]]
local woodParts = {}
task.spawn(function()
    local angle = 0
    while true do
        if _G_States.WoodShield and LocalPlayer.Character then
            -- âœ… FIX: Ø²ÙŠØ§Ø¯Ø© Ø³Ø±Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±
            angle = angle + 150 
            local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                
                -- 1. Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ© Ø¹Ù„ÙŠÙ‡Ø§
                for _, v in pairs(workspace:GetDescendants()) do
                    if v:IsA("BasePart") and not v.Anchored and not v:IsDescendantOf(LocalPlayer.Character) and not v.Parent:FindFirstChild("Humanoid") and not v.Parent:IsA("Accessory") then
                        if v.Name:lower():find("wood") or v.Name:lower():find("door") or v.Material == Enum.Material.Wood then
                            
                            if not v:FindFirstChild("WallhanAlign") then
                                
                                for _, m in pairs(v:GetChildren()) do
                                    if m:IsA("BodyMover") or m:IsA("AlignPosition") or m:IsA("Attachment") then m:Destroy() end
                                end
                                
                                local a0 = Instance.new("Attachment", v)
                                local a1 = Instance.new("Attachment", hrp)
                                local al = Instance.new("AlignPosition", v)
                                al.Name = "WallhanAlign"
                                al.Attachment0 = a0
                                al.Attachment1 = a1
                                al.MaxForce = math.huge
                                al.MaxVelocity = math.huge
                                al.Responsiveness = 500
                                
                                -- âœ… FIX: Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©)
                                local radius = 1.5 
                                local y_offset = 0 -- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©
                                a1.Position = Vector3.new(
                                    math.cos(math.rad(angle)) * radius, 
                                    y_offset, 
                                    math.sin(math.rad(angle)) * radius
                                )
                                
                                v.CanCollide = false
                                v.CanTouch = true -- âœ… FIX: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø®Ø§ØµÙŠØ© Ø§Ù„Ù„Ù…Ø³ Ù…ÙØ¹Ù„Ø©
                                
                                table.insert(woodParts, {part = v, align = al, att = a1})
                                
                                -- âœ… FIX: Ø²ÙŠØ§Ø¯Ø© Ù‚ÙˆØ© Ø§Ù„Ù‚Ø°Ù
                                v.Touched:Connect(function(hit)
                                    local hitHumanoid = hit.Parent:FindFirstChildOfClass("Humanoid")
                                    if hitHumanoid and hitHumanoid.Parent ~= LocalPlayer.Character then
                                        local targetHRP = hitHumanoid.Parent:FindFirstChild("HumanoidRootPart")
                                        if targetHRP then
                                            -- âœ… FIX: Ø²ÙŠØ§Ø¯Ø© Ù‚ÙˆØ© Ø§Ù„Ù‚Ø°Ù Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                                            local direction = (targetHRP.Position - hrp.Position).Unit
                                            targetHRP.Velocity = direction * 2000 + Vector3.new(0, 200, 0) 
                                        end
                                    end
                                end)
                            end
                        end
                    end
                end
                
                -- 2. ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                for _, data in pairs(woodParts) do
                    if data.att and data.att.Parent then
                        local radius = 1.5
                        local y_offset = 0
                        data.att.Position = Vector3.new(
                            math.cos(math.rad(angle)) * radius, 
                            y_offset, 
                            math.sin(math.rad(angle)) * radius
                        )
                    else
                        -- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ¯Ù…Ø±Øª Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©
                        if data.align and data.align.Parent then data.align:Destroy() end
                        if data.att and data.att.Parent then data.att:Destroy() end
                        table.remove(woodParts, table.find(woodParts, data))
                    end
                end
            end
        else
            -- ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ attachments Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯Ø±Ø¹
            for _, data in pairs(woodParts) do
                if data.align and data.align.Parent then data.align:Destroy() end
                if data.att and data.att.Parent then data.att:Destroy() end
            end
            woodParts = {}
        end
        
        RunService.Heartbeat:Wait()
    end
end)

-- [[ Anti-Ragdoll & Noclip & ESP ]]
RunService.Stepped:Connect(function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.PlatformStand = false
        if _G_States.Noclip then
            for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end
end)

RunService.RenderStepped:Connect(function()
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            if _G_States.ESP then
                if not p.Character:FindFirstChild("BoxESP") then
                    local b = Instance.new("BoxHandleAdornment", p.Character)
                    b.Name, b.AlwaysOnTop, b.Adornee = "BoxESP", true, p.Character
                    b.Size, b.Color3, b.Transparency = p.Character:GetExtentsSize(), Color3.new(1,0,0), 0.6
                    local bill = Instance.new("BillboardGui", p.Character)
                    bill.Name, bill.Size, bill.AlwaysOnTop = "NameESP", UDim2.new(0, 100, 0, 50), true
                    bill.Adornee = p.Character:FindFirstChild("Head")
                    local lbl = Instance.new("TextLabel", bill)
                    lbl.Size, lbl.Text = UDim2.new(1, 0, 1, 0), p.Name
                    lbl.BackgroundTransparency, lbl.TextColor3 = 1, Color3.new(1,0,0)
                    lbl.Font, lbl.TextSize = Enum.Font.GothamBold, 14
                    Instance.new("UIStroke", lbl).Thickness = 1
                end
            else
                if p.Character:FindFirstChild("BoxESP") then p.Character.BoxESP:Destroy() end
                if p.Character:FindFirstChild("NameESP") then p.Character.NameESP:Destroy() end
            end
        end
    end
end)

-- [[ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ]]
CreateMinimalUI()
