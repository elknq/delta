Local MASTER_KEY = "daddy" 
local VALID_KEYS = {
    ["0x1xxxxjwj"] = true,
    ["iloveyoudaddywallhan"] = true
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- [[ KEY SYSTEM UI ]]
local KeyGui = Instance.new("ScreenGui", game.CoreGui)
local KeyFrame = Instance.new("Frame", KeyGui)
KeyFrame.Size = UDim2.new(0, 300, 0, 160)
KeyFrame.Position = UDim2.new(0.5, -150, 0.5, -80)
KeyFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
KeyFrame.Active = true
KeyFrame.Draggable = true
Instance.new("UICorner", KeyFrame)

local KeyInput = Instance.new("TextBox", KeyFrame)
KeyInput.Size = UDim2.new(0.8, 0, 0, 35)
KeyInput.Position = UDim2.new(0.1, 0, 0.35, 0)
KeyInput.PlaceholderText = "Enter Key..."
KeyInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
KeyInput.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", KeyInput)

local Submit = Instance.new("TextButton", KeyFrame)
Submit.Size = UDim2.new(0.8, 0, 0, 35)
Submit.Position = UDim2.new(0.1, 0, 0.65, 0)
Submit.Text = "ACTIVATE"
Submit.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
Submit.TextColor3 = Color3.new(1, 1, 1)
Submit.Font = Enum.Font.GothamBold
Instance.new("UICorner", Submit)

-- [[ START V42 CORE ]]
local function StartWallhan()
    KeyGui:Destroy()
    
    local _G_States = { ESP = false, Noclip = false, WoodShield = false }
    local targetName = ""
    local FlingActive = false

    local sg = Instance.new("ScreenGui", game.CoreGui)
    local Main = Instance.new("Frame", sg)
    Main.Size = UDim2.new(0, 260, 0, 400)
    Main.Position = UDim2.new(1, -270, 0.5, -200)
    Main.BackgroundColor3 = Color3.fromRGB(12, 12, 18)
    Main.Active = true
    Main.Draggable = true
    Instance.new("UICorner", Main)

    local Header = Instance.new("TextLabel", Main)
    Header.Size = UDim2.new(1, 0, 0, 40)
    Header.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    Header.Text = "Wallhan2much V1"
    Header.TextColor3 = Color3.new(1,1,1)
    Header.Font = Enum.Font.GothamBold
    Instance.new("UICorner", Header)

    local List = Instance.new("ScrollingFrame", Main)
    List.Size = UDim2.new(1, -15, 1, -55)
    List.Position = UDim2.new(0, 7, 0, 45)
    List.BackgroundTransparency = 1
    List.CanvasSize = UDim2.new(0, 0, 6, 0)
    Instance.new("UIListLayout", List).Padding = UDim.new(0, 5)

    local function CreateButton(txt, color, cb)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(1, 0, 0, 35)
        b.BackgroundColor3 = color
        b.Text = txt
        b.TextColor3 = Color3.new(1,1,1)
        b.Font = Enum.Font.GothamBold
        b.MouseButton1Click:Connect(cb)
        Instance.new("UICorner", b)
    end

    local function CreateToggle(txt, stateKey)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(1, 0, 0, 35)
        b.Font = Enum.Font.GothamBold
        local function Upd()
            b.Text = txt .. (_G_States[stateKey] and " [ON]" or " [OFF]")
            b.BackgroundColor3 = _G_States[stateKey] and Color3.fromRGB(0, 150, 80) or Color3.fromRGB(35, 35, 45)
        end
        b.MouseButton1Click:Connect(function() _G_States[stateKey] = not _G_States[stateKey] Upd() end)
        Upd()
        Instance.new("UICorner", b)
    end

    local inp = Instance.new("TextBox", List)
    inp.Size = UDim2.new(1, 0, 0, 40)
    inp.PlaceholderText = "Target Username..."
    inp.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    inp.TextColor3 = Color3.new(1,1,1)
    inp.Changed:Connect(function() targetName = inp.Text end)
    Instance.new("UICorner", inp)

    CreateButton("GIVE TOOLS üéí", Color3.fromRGB(180, 50, 0), function()
        local tp = Instance.new("Tool", LocalPlayer.Backpack)
        tp.Name = "Wallhan TP üìç" tp.RequiresHandle = false
        tp.Activated:Connect(function() LocalPlayer.Character:MoveTo(Mouse.Hit.p) end)
    end)

    CreateToggle("WOOD SHIELD FE üå™Ô∏è", "WoodShield")

    CreateButton("GHOST FLING üå™Ô∏è‚ö°", Color3.fromRGB(0, 100, 200), function()
        FlingActive = true
        task.spawn(function()
            local r = 0
            while FlingActive and LocalPlayer.Character do
                r = r + 2.5
                for _, p in pairs(Players:GetPlayers()) do
                    if p.Name:lower():find(targetName:lower()) and p.Character then
                        local hrp = LocalPlayer.Character.HumanoidRootPart
                        hrp.CFrame = p.Character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(r*180), 0) * CFrame.new(0,0,0.1)
                        hrp.Velocity = Vector3.new(9e6, 9e6, 9e6)
                        for _, v in pairs(LocalPlayer.Character:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
                    end
                end
                RunService.Heartbeat:Wait()
            end
        end)
    end)

    CreateButton("STOP FLING üõë", Color3.fromRGB(150, 0, 0), function() FlingActive = false end)
    CreateToggle("X-RAY ESP üëÅÔ∏è", "ESP")
    CreateToggle("NOCLIP üß±", "Noclip")

    task.spawn(function()
        local angle = 0
        while true do
            if _G_States.WoodShield and LocalPlayer.Character then
                angle = angle + 4
                local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    -- [[ MODIFIED TARGET LOGIC ]]
                    local currentTargetHRP = hrp
                    if targetName ~= "" then
                        for _, p in pairs(Players:GetPlayers()) do
                            if p.Name:lower():find(targetName:lower()) and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                                currentTargetHRP = p.Character.HumanoidRootPart
                                break
                            end
                        end
                    end
                    -- [[ END MODIFIED TARGET LOGIC ]]

                    for _, v in pairs(workspace:GetDescendants()) do
                        if v:IsA("BasePart") and not v.Anchored and not v:IsDescendantOf(LocalPlayer.Character) then
                            if v.Name:lower():find("wood") or v.Name:lower():find("door") or v.Material == Enum.Material.Wood then
                                for _, m in pairs(v:GetChildren()) do
                                    if m:IsA("BodyMover") or m:IsA("AlignPosition") or m:IsA("Attachment") then m:Destroy() end
                                end
                                -- Using currentTargetHRP instead of hrp
                                local a0, a1 = Instance.new("Attachment", v), Instance.new("Attachment", currentTargetHRP)
                                local al = Instance.new("AlignPosition", v)
                                al.Attachment0, al.Attachment1 = a0, a1
                                al.MaxForce, al.MaxVelocity, al.Responsiveness = math.huge, math.huge, 500
                                a1.Position = Vector3.new(math.cos(angle)*1.2, 0, math.sin(angle)*1.2)
                                v.Velocity = Vector3.new(1000, 1000, 1000)
                                v.CanCollide = false
                                game:GetService("Debris"):AddItem(a1, 0.1)
                            end
                        end
                    end
                end
            end
            RunService.Heartbeat:Wait()
        end
    end)

    RunService.Stepped:Connect(function()
        if _G_States.Noclip and LocalPlayer.Character then
            for _, v in pairs(LocalPlayer.Character:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
        end
    end)

    RunService.RenderStepped:Connect(function()
        if _G_States.ESP then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Character then
                    local h = p.Character:FindFirstChild("ZE") or Instance.new("Highlight", p.Character)
                    h.Name = "ZE" h.FillColor = Color3.new(1,0,0) h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                end
            end
        end
    end)

    local ToggleBtn = Instance.new("TextButton", sg)
    ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
    ToggleBtn.Position = UDim2.new(0, 20, 0, 20)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    ToggleBtn.Text = "W"
    ToggleBtn.TextColor3 = Color3.new(1,1,1)
    ToggleBtn.Font = Enum.Font.GothamBold
    ToggleBtn.Draggable = true
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    ToggleBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
end

Submit.MouseButton1Click:Connect(function()
    if KeyInput.Text == MASTER_KEY or VALID_KEYS[KeyInput.Text] then
        StartWallhan()
    else
        Submit.Text = "WRONG KEY"
        task.wait(1)
        Submit.Text = "ACTIVATE"
    end
end)
