--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘       WALLHAN HUB - ORIGINAL UI FIX      â•‘
    â•‘  FE Emote, Advanced Wood Shield, Old UI  â•‘
    â•‘  âœ… FIX: Compatibility with Delta/iPhone  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

local MASTER_KEY = "daddy" 
local VALID_KEYS = {["0x1xxxxjwj"] = true, ["iloveyoudaddywallhan"] = true}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService") -- ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„ÙŠÙ‡ Ù„Ù„Ù€ Wood Shield

-- âœ… FIX: Ø³ÙŠØªÙ… ØªØ¹Ø±ÙŠÙ LocalPlayer Ùˆ Mouse Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨
local LocalPlayer
local Mouse

-- Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙŠÙ†Øª
local SavedCheckpoint = nil

-- [[ Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ§Øª - Beautiful Dance (FE) ]]
local function PlayFEEmote(animationId)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. animationId
        local load = LocalPlayer.Character.Humanoid:LoadAnimation(anim)
        load.Priority = Enum.AnimationPriority.Action -- Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµØ© Ø±Ø¤ÙŠØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù„Ù‡Ø§
        load:Play()
        
        -- Ø¥Ø´Ø¹Ø§Ø±
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "âœ¨ Wallhan Emotes",
            Text = "ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ© (FE)!",
            Duration = 3
        })
    end
end

-- [[ Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ§Øª - Beautiful Dance ÙÙ‚Ø· (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) ]]
local function OpenWallhanEmotes()
    -- âœ… FIX: Ø§Ø³ØªØ®Ø¯Ø§Ù… PlayerGui Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ±
    local parentGui = game.CoreGui
    if LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui") then
        parentGui = LocalPlayer.PlayerGui
    end
    
    local existingGui = parentGui:FindFirstChild("WallhanEmotesMenu")
    if existingGui then existingGui:Destroy() end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WallhanEmotesMenu"
    ScreenGui.DisplayOrder = 999
    ScreenGui.Parent = parentGui -- âœ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù€ Parent
    
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = UDim2.new(0, 300, 0, 200) -- Ø­Ø¬Ù… Ø£ØµØºØ± (Ø§Ù„Ù‚Ø¯ÙŠÙ…)
    MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
    MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    MainFrame.Active = true
    MainFrame.Draggable = true
    Instance.new("UICorner", MainFrame)
    local stroke = Instance.new("UIStroke", MainFrame)
    stroke.Color = Color3.fromRGB(200, 0, 0)
    stroke.Thickness = 2

    local Title = Instance.new("TextLabel", MainFrame)
    Title.Size = UDim2.new(1, 0, 0, 45)
    Title.Text = "ğŸ’ƒ BEAUTIFUL DANCE ğŸ’ƒ"
    Title.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Instance.new("UICorner", Title)

    -- Ø²Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ù‚ØµØ© Ø§Ù„ÙˆØ­ÙŠØ¯Ø©
    local DanceButton = Instance.new("TextButton", MainFrame)
    DanceButton.Size = UDim2.new(0.8, 0, 0, 60)
    DanceButton.Position = UDim2.new(0.1, 0, 0.3, 0)
    DanceButton.Text = "ğŸ’ƒ PLAY BEAUTIFUL DANCE ğŸ’ƒ"
    DanceButton.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
    DanceButton.TextColor3 = Color3.new(1, 1, 1)
    DanceButton.Font = Enum.Font.GothamBold
    DanceButton.TextSize = 14
    Instance.new("UICorner", DanceButton)
    
    -- ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
    DanceButton.MouseButton1Click:Connect(function()
        PlayFEEmote("4077918384157") -- âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù€ ID ÙˆØ¬Ø¹Ù„Ù‡Ø§ FE
    end)

    -- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    local Close = Instance.new("TextButton", MainFrame)
    Close.Size = UDim2.new(0, 30, 0, 30)
    Close.Position = UDim2.new(1, -35, 0, 7)
    Close.Text = "âœ•"
    Close.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
    Close.TextColor3 = Color3.new(1, 1, 1)
    Close.Font = Enum.Font.GothamBold
    Close.TextSize = 16
    Instance.new("UICorner", Close)
    
    Close.MouseButton1Click:Connect(function() 
        ScreenGui:Destroy() 
    end)
end

-- [[ START CORE ]]
local function StartWallhan()
    local _G_States = { ESP = false, Noclip = false, WoodShield = false, AntiFling = false }
    
    -- âœ… FIX: ØªØ¹Ø±ÙŠÙ LocalPlayer Ùˆ Mouse Ù‡Ù†Ø§
    LocalPlayer = Players.LocalPlayer
    Mouse = LocalPlayer:GetMouse()
    
    -- âœ… FIX: Ø§Ø³ØªØ®Ø¯Ø§Ù… PlayerGui Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ±
    local parentGui = game.CoreGui
    if LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui") then
        parentGui = LocalPlayer.PlayerGui
    end
    
    local sg = Instance.new("ScreenGui")
    sg.Name = "WallhanHub"
    sg.ResetOnSpawn = false
    sg.Parent = parentGui -- âœ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù€ Parent Ù‡Ù†Ø§
    
    local Main = Instance.new("Frame", sg)
    Main.Size, Main.Position = UDim2.new(0, 260, 0, 580), UDim2.new(1, -270, 0.5, -290) -- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    Main.BackgroundColor3, Main.Active, Main.Draggable = Color3.fromRGB(0, 0, 0), true, true
    Instance.new("UIStroke", Main).Color = Color3.fromRGB(150, 0, 0)
    Instance.new("UICorner", Main)

    local List = Instance.new("ScrollingFrame", Main)
    List.Size, List.Position = UDim2.new(1, -15, 1, -70), UDim2.new(0, 7, 0, 60)
    List.BackgroundTransparency, List.CanvasSize = 1, UDim2.new(0, 0, 3.2, 0)
    Instance.new("UIListLayout", List).Padding = UDim.new(0, 8)

    local function CreateButton(txt, cb)
        local b = Instance.new("TextButton", List)
        b.Size, b.BackgroundColor3, b.Text = UDim2.new(0.95, 0, 0, 40), Color3.fromRGB(130, 0, 0), txt
        b.TextColor3, b.Font = Color3.new(1,1,1), Enum.Font.GothamBold
        Instance.new("UIStroke", b).Thickness = 1
        b.MouseButton1Click:Connect(cb)
        Instance.new("UICorner", b)
    end

    local function CreateToggle(txt, stateKey)
        local b = Instance.new("TextButton", List)
        b.Size, b.Font = UDim2.new(0.95, 0, 0, 40), Enum.Font.GothamBold
        local function Upd()
            b.Text = txt .. (_G_States[stateKey] and " [ON]" or " [OFF]")
            b.BackgroundColor3 = _G_States[stateKey] and Color3.fromRGB(200, 0, 0) or Color3.fromRGB(45, 0, 0)
        end
        b.MouseButton1Click:Connect(function() _G_States[stateKey] = not _G_States[stateKey] Upd() end)
        Upd()
        Instance.new("UICorner", b)
    end

    -- [ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ]
    CreateButton("SET CHECKPOINT ğŸš©", function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            SavedCheckpoint = LocalPlayer.Character.HumanoidRootPart.CFrame
            game:GetService("StarterGui"):SetCore("SendNotification", {Title = "Wallhan Hub", Text = "Checkpoint Saved! âœ…", Duration = 3})
        end
    end)

    CreateButton("TP TO CHECKPOINT ğŸŒ€", function()
        if SavedCheckpoint and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = SavedCheckpoint
        else
            game:GetService("StarterGui"):SetCore("SendNotification", {Title = "Wallhan Hub", Text = "No Checkpoint Set! âŒ", Duration = 3})
        end
    end)

    CreateButton("RANDOM PLAYER TP ğŸ²", function()
        local plrs = Players:GetPlayers()
        local rP = plrs[math.random(1, #plrs)]
        if rP and rP ~= LocalPlayer and rP.Character then
            LocalPlayer.Character:SetPrimaryPartCFrame(rP.Character.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0))
        end
    end)

    CreateButton("WALLHAN EMOTES ğŸ•º", function()
        OpenWallhanEmotes()
    end)

    CreateButton("GIVE TELEPORT TOOL ğŸ“", function()
        local tp = Instance.new("Tool", LocalPlayer.Backpack)
        tp.Name, tp.RequiresHandle = "Wallhan TP ğŸ“", false
        tp.Activated:Connect(function() LocalPlayer.Character:MoveTo(Mouse.Hit.p) end)
    end)
    
    CreateToggle("ULTIMATE ANTI-FLING ğŸ›¡ï¸", "AntiFling")
    CreateToggle("WOOD SHIELD ğŸŒªï¸", "WoodShield")
    CreateToggle("BOX ESP + NAMES ğŸ‘ï¸", "ESP")
    CreateToggle("NOCLIP ğŸ§±", "Noclip")

    -- [[ Wood Shield - Ù…Ø­Ø³Ù‘Ù† (ÙŠØ¨Ù‚Ù‰ Ù„Ø£Ø·ÙˆÙ„ Ù…Ø¯Ø©ØŒ Ø¯ÙˆØ±Ø§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØŒ ÙŠÙ‚Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†) ]]
    task.spawn(function()
        local angle = 0
        local woodParts = {} -- Ù„Ø­ÙØ¸ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§
        
        while true do
            if _G_States.WoodShield and LocalPlayer.Character then
                angle = angle + 4
                local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    
                    -- 1. Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ© Ø¹Ù„ÙŠÙ‡Ø§
                    for _, v in pairs(workspace:GetDescendants()) do
                        if v:IsA("BasePart") and not v.Anchored and not v:IsDescendantOf(LocalPlayer.Character) and not v.Parent:FindFirstChild("Humanoid") and not v.Parent:IsA("Accessory") then
                            if v.Name:lower():find("wood") or v.Name:lower():find("door") or v.Material == Enum.Material.Wood then
                                
                                -- Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ AlignPosition Ù…Ø³Ø¨Ù‚Ø§Ù‹
                                if not v:FindFirstChild("WallhanAlign") then
                                    
                                    -- ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ BodyMovers Ù‚Ø¯ÙŠÙ…Ø©
                                    for _, m in pairs(v:GetChildren()) do
                                        if m:IsA("BodyMover") or m:IsA("AlignPosition") or m:IsA("Attachment") then m:Destroy() end
                                    end
                                    
                                    local a0 = Instance.new("Attachment", v)
                                    local a1 = Instance.new("Attachment", hrp)
                                    local al = Instance.new("AlignPosition", v)
                                    al.Name = "WallhanAlign"
                                    al.Attachment0 = a0
                                    al.Attachment1 = a1
                                    al.MaxForce = math.huge
                                    al.MaxVelocity = math.huge
                                    al.Responsiveness = 500
                                    
                                    -- âœ… Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (ÙŠÙ…ÙŠÙ†ØŒ ÙŠØ³Ø§Ø±ØŒ ÙÙˆÙ‚ØŒ ØªØ­Øª)
                                    local radius = 3 -- Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                                    local y_offset = math.sin(math.rad(angle * 2)) * 1.5 -- Ø­Ø±ÙƒØ© Ø¹Ù…ÙˆØ¯ÙŠØ©
                                    a1.Position = Vector3.new(
                                        math.cos(math.rad(angle)) * radius, 
                                        y_offset, 
                                        math.sin(math.rad(angle)) * radius
                                    )
                                    
                                    v.CanCollide = false -- Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù†ÙØ³Ù‡
                                    
                                    -- âœ… ÙŠØ¨Ù‚Ù‰ Ù„Ø£Ø·ÙˆÙ„ Ù…Ø¯Ø©: Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… Debris:AddItem
                                    table.insert(woodParts, {part = v, align = al, att = a1})
                                    
                                    -- âœ… ÙŠÙ‚Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Touch
                                    v.Touched:Connect(function(hit)
                                        local hitHumanoid = hit.Parent:FindFirstChildOfClass("Humanoid")
                                        if hitHumanoid and hitHumanoid.Parent ~= LocalPlayer.Character then
                                            local targetHRP = hitHumanoid.Parent:FindFirstChild("HumanoidRootPart")
                                            if targetHRP then
                                                local direction = (targetHRP.Position - hrp.Position).Unit
                                                targetHRP.Velocity = direction * 150 + Vector3.new(0, 50, 0) -- Ù‚ÙˆØ© Ù‚Ø°Ù Ø¹Ø§Ù„ÙŠØ©
                                            end
                                        end
                                    end)
                                end
                            end
                        end
                    end
                    
                    -- 2. ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                    for _, data in pairs(woodParts) do
                        if data.att and data.att.Parent then
                            local radius = 3
                            local y_offset = math.sin(math.rad(angle * 2)) * 1.5
                            data.att.Position = Vector3.new(
                                math.cos(math.rad(angle)) * radius, 
                                y_offset, 
                                math.sin(math.rad(angle)) * radius
                            )
                        else
                            -- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ¯Ù…Ø±Øª Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©
                            data.align:Destroy()
                            data.att:Destroy()
                            table.remove(woodParts, table.find(woodParts, data))
                        end
                    end
                end
            else
                -- ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ attachments Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯Ø±Ø¹
                for _, data in pairs(woodParts) do
                    if data.align and data.align.Parent then data.align:Destroy() end
                    if data.att and data.att.Parent then data.att:Destroy() end
                end
                woodParts = {}
            end
            
            RunService.Heartbeat:Wait()
        end
    end)

    -- [[ Anti-Ragdoll & Noclip & ESP (ÙƒÙ…Ø§ Ù‡ÙŠ) ]]
    RunService.Stepped:Connect(function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.PlatformStand = false
            if _G_States.Noclip then
                for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        end
    end)

    RunService.RenderStepped:Connect(function()
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character then
                if _G_States.ESP then
                    if not p.Character:FindFirstChild("BoxESP") then
                        local b = Instance.new("BoxHandleAdornment", p.Character)
                        b.Name = "BoxESP"
                        b.AlwaysOnTop = true
                        b.Adornee = p.Character
                        b.Size = p.Character:GetExtentsSize()
                        b.Color3 = Color3.fromRGB(255, 0, 0)
                        b.Transparency = 0.6
                        
                        local bill = Instance.new("BillboardGui", p.Character)
                        bill.Name = "NameESP"
                        bill.Size = UDim2.new(0, 100, 0, 50)
                        bill.AlwaysOnTop = true
                        bill.Adornee = p.Character:FindFirstChild("Head")
                        
                        local lbl = Instance.new("TextLabel", bill)
                        lbl.Size = UDim2.new(1, 0, 1, 0)
                        lbl.Text = p.Name
                        lbl.BackgroundTransparency = 1
                        lbl.TextColor3 = Color3.new(1, 0, 0)
                        lbl.Font = Enum.Font.GothamBold
                        lbl.TextSize = 14
                        
                        Instance.new("UIStroke", lbl).Thickness = 1
                    end
                else
                    if p.Character:FindFirstChild("BoxESP") then p.Character.BoxESP:Destroy() end
                    if p.Character:FindFirstChild("NameESP") then p.Character.NameESP:Destroy() end
                end
            end
        end
    end)

    local ToggleBtn = Instance.new("TextButton", sg)
    ToggleBtn.Size, ToggleBtn.Position = UDim2.new(0, 50, 0, 50), UDim2.new(0, 20, 0, 20)
    ToggleBtn.BackgroundColor3, ToggleBtn.Text = Color3.new(0,0,0), "W"
    ToggleBtn.TextColor3, ToggleBtn.Font, ToggleBtn.TextSize = Color3.fromRGB(200, 0, 0), Enum.Font.GothamBold, 25
    ToggleBtn.Draggable = true
    Instance.new("UIStroke", ToggleBtn).Color = Color3.fromRGB(200, 0, 0)
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    ToggleBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
end

-- [[ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ]]
local function InitializeKeySystem()
    
    -- âœ… FIX: ØªØ¹Ø±ÙŠÙ LocalPlayer Ùˆ Mouse Ù‡Ù†Ø§
    LocalPlayer = Players.LocalPlayer
    Mouse = LocalPlayer:GetMouse()
    
    local KeyGui = Instance.new("ScreenGui")
    KeyGui.Name = "Wall
(Content truncated due to size limit. Use page ranges or line ranges to read remaining content)
