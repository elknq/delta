-- [[ WALLHAN V10 - FORCE EDITION ]]
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local _G_States = { WoodShield = false, ESP = false, DoorESP = false }
local targetPlayer = nil
local checkpointPos = nil

-- [[ UI CREATION ]]
local sg = Instance.new("ScreenGui")
sg.Name = "WallhanV10"
sg.ResetOnSpawn = false
local success, err = pcall(function() sg.Parent = game:GetService("CoreGui") end)
if not success then sg.Parent = LocalPlayer:WaitForChild("PlayerGui") end

local Main = Instance.new("Frame", sg)
Main.Size = UDim2.new(0, 240, 0, 450)
Main.Position = UDim2.new(0.5, -120, 0.2, 0)
Main.BackgroundColor3 = Color3.fromRGB(15, 0, 0)
Main.BorderSizePixel = 2
Main.BorderColor3 = Color3.fromRGB(255, 0, 0)
Main.Active = true
Main.Draggable = true

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1, 0, 0, 35)
Title.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
Title.Text = "WALLHAN V10 FORCE"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18

local List = Instance.new("ScrollingFrame", Main)
List.Size = UDim2.new(1, -10, 1, -70)
List.Position = UDim2.new(0, 5, 0, 40)
List.BackgroundTransparency = 1
List.CanvasSize = UDim2.new(0, 0, 2, 0)
List.ScrollBarThickness = 4

local layout = Instance.new("UIListLayout", List)
layout.Padding = UDim.new(0, 5)

local function CreateButton(txt, cb)
    local b = Instance.new("TextButton", List)
    b.Size = UDim2.new(1, 0, 0, 35)
    b.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
    b.Text = txt
    b.TextColor3 = Color3.new(1, 1, 1)
    b.Font = Enum.Font.SourceSansBold
    b.MouseButton1Click:Connect(cb)
    Instance.new("UICorner", b)
    return b
end

local function CreateToggle(txt, key)
    local b = Instance.new("TextButton", List)
    b.Size = UDim2.new(1, 0, 0, 35)
    local function Upd()
        b.Text = txt .. (_G_States[key] and " [ON]" or " [OFF]")
        b.BackgroundColor3 = _G_States[key] and Color3.fromRGB(200, 0, 0) or Color3.fromRGB(60, 0, 0)
    end
    b.MouseButton1Click:Connect(function() _G_States[key] = not _G_States[key] Upd() end)
    Upd()
    Instance.new("UICorner", b)
    return b
end

local function CreateInput(placeholder)
    local i = Instance.new("TextBox", List)
    i.Size = UDim2.new(1, 0, 0, 35)
    i.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
    i.PlaceholderText = placeholder
    i.Text = ""
    i.TextColor3 = Color3.new(1, 1, 1)
    i.Font = Enum.Font.SourceSans
    Instance.new("UICorner", i)
    return i
end

-- [[ WOOD SHIELD SECTION ]]
local woodInp = CreateInput("Target Name (e.g. 'j')")
local TargetDisplay = Instance.new("TextLabel", List)
TargetDisplay.Size = UDim2.new(1, 0, 0, 25)
TargetDisplay.BackgroundTransparency = 1
TargetDisplay.Text = "Target: NONE (YOU)"
TargetDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
TargetDisplay.Font = Enum.Font.SourceSansItalic
TargetDisplay.TextSize = 14

woodInp:GetPropertyChangedSignal("Text"):Connect(function()
    local text = woodInp.Text:lower()
    if text == "" then
        targetPlayer = nil
        TargetDisplay.Text = "Target: NONE (YOU)"
    else
        local found = false
        for _, p in pairs(Players:GetPlayers()) do
            if p.Name:lower():find(text) or p.DisplayName:lower():find(text) then
                targetPlayer = p
                TargetDisplay.Text = "Target: " .. p.Name
                found = true
                break
            end
        end
        if not found then
            targetPlayer = nil
            TargetDisplay.Text = "Target: NOT FOUND"
        end
    end
end)

CreateToggle("WOOD SHIELD", "WoodShield")
CreateToggle("DOOR & WOOD ESP", "DoorESP")
CreateToggle("PLAYER RED ESP", "ESP")

CreateButton("GIVE TP TOOL", function()
    local t = Instance.new("Tool", LocalPlayer.Backpack)
    t.Name = "Wallhan TP" t.RequiresHandle = false
    t.Activated:Connect(function() LocalPlayer.Character:MoveTo(Mouse.Hit.p) end)
end)

CreateButton("SET CHECKPOINT", function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        checkpointPos = LocalPlayer.Character.HumanoidRootPart.CFrame
    end
end)

CreateButton("TP TO CHECKPOINT", function()
    if checkpointPos and LocalPlayer.Character then
        LocalPlayer.Character.HumanoidRootPart.CFrame = checkpointPos
    end
end)

-- Rights Label
local Rights = Instance.new("TextLabel", Main)
Rights.Size = UDim2.new(1, 0, 0, 30)
Rights.Position = UDim2.new(0, 0, 1, -30)
Rights.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
Rights.Text = "Made by Wallhan"
Rights.TextColor3 = Color3.new(1, 1, 1)
Rights.Font = Enum.Font.SourceSansBold

-- Toggle Button
local TogBtn = Instance.new("TextButton", sg)
TogBtn.Size = UDim2.new(0, 45, 0, 45)
TogBtn.Position = UDim2.new(0, 10, 0, 50)
TogBtn.Text = "W"
TogBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
TogBtn.TextColor3 = Color3.new(1, 1, 1)
TogBtn.Draggable = true
TogBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)

-- [[ CORE LOGIC ]]

-- FORCE Wood Shield Logic (BodyVelocity)
task.spawn(function()
    while true do
        if _G_States.WoodShield and LocalPlayer.Character then
            local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                local finalTargetHRP = hrp
                if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    finalTargetHRP = targetPlayer.Character.HumanoidRootPart
                end
                
                for _, v in pairs(workspace:GetDescendants()) do
                    if v:IsA("BasePart") and not v.Anchored and not v:IsDescendantOf(LocalPlayer.Character) then
                        if v.Name:lower():find("wood") or v.Name:lower():find("door") or v.Material == Enum.Material.Wood then
                            -- Use BodyVelocity for direct and forced movement
                            local bv = v:FindFirstChild("WallhanBV") or Instance.new("BodyVelocity", v)
                            bv.Name = "WallhanBV"
                            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                            
                            -- Calculate direction and force movement
                            local direction = (finalTargetHRP.Position - v.Position).Unit
                            local distance = (finalTargetHRP.Position - v.Position).Magnitude
                            
                            if distance > 5 then
                                bv.Velocity = direction * 300 -- Fast travel to target
                            else
                                -- Orbit/Spin around target when close
                                local orbit = Vector3.new(math.cos(tick()*10), 0, math.sin(tick()*10)) * 5
                                bv.Velocity = (finalTargetHRP.Position + orbit - v.Position) * 50
                            end
                            
                            -- Fling Logic on Touch
                            v.Touched:Connect(function(hit)
                                if _G_States.WoodShield and hit.Parent:FindFirstChild("Humanoid") and hit.Parent ~= LocalPlayer.Character then
                                    local victimHRP = hit.Parent:FindFirstChild("HumanoidRootPart")
                                    if victimHRP then
                                        victimHRP.Velocity = Vector3.new(0, 1e6, 0) + (victimHRP.Position - v.Position).Unit * 1e6
                                    end
                                end
                            end)
                            
                            v.CanCollide = true
                        end
                    end
                end
            end
        else
            -- Cleanup when OFF
            for _, v in pairs(workspace:GetDescendants()) do
                if v:FindFirstChild("WallhanBV") then v.WallhanBV:Destroy() end
            end
        end
        RunService.Heartbeat:Wait()
    end
end)

-- DOOR & PLAYER ESP Logic
RunService.RenderStepped:Connect(function()
    -- Player ESP
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local char = p.Character
            local esp = char:FindFirstChild("WallhanPlayerESP")
            if _G_States.ESP then
                if not esp then
                    local folder = Instance.new("Folder", char)
                    folder.Name = "WallhanPlayerESP"
                    local h = Instance.new("Highlight", folder)
                    h.FillTransparency = 1
                    h.OutlineColor = Color3.new(1, 0, 0)
                    h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    local bg = Instance.new("BillboardGui", folder)
                    bg.Size = UDim2.new(0, 200, 0, 50)
                    bg.Adornee = char:FindFirstChild("Head")
                    bg.AlwaysOnTop = true
                    bg.ExtentsOffset = Vector3.new(0, 3, 0)
                    local tl = Instance.new("TextLabel", bg)
                    tl.Size = UDim2.new(1, 0, 1, 0)
                    tl.BackgroundTransparency = 1
                    tl.Text = p.Name
                    tl.TextColor3 = Color3.new(1, 0, 0)
                    tl.Font = Enum.Font.SourceSansBold
                    tl.TextSize = 14
                end
            else
                if esp then esp:Destroy() end
            end
        end
    end
    
    -- Door & Wood ESP
    if _G_States.DoorESP then
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not v.Anchored and (v.Name:lower():find("wood") or v.Name:lower():find("door") or v.Material == Enum.Material.Wood) then
                if not v:FindFirstChild("WallhanDoorESP") then
                    local bg = Instance.new("BillboardGui", v)
                    bg.Name = "WallhanDoorESP"
                    bg.Size = UDim2.new(0, 100, 0, 30)
                    bg.AlwaysOnTop = true
                    local tl = Instance.new("TextLabel", bg)
                    tl.Size = UDim2.new(1, 0, 1, 0)
                    tl.BackgroundTransparency = 1
                    tl.Text = "[ " .. v.Name .. " ]"
                    tl.TextColor3 = Color3.new(1, 1, 0)
                    tl.Font = Enum.Font.SourceSansBold
                    tl.TextSize = 10
                end
            end
        end
    else
        for _, v in pairs(workspace:GetDescendants()) do
            if v:FindFirstChild("WallhanDoorESP") then v.WallhanDoorESP:Destroy() end
        end
    end
end)
